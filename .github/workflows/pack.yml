name: Pack

on:
  workflow_dispatch:
    inputs:
      versionMajor:
        description: 'Version Major'
        required: true
        type: number
      versionMinor:
        description: 'Version Minor'
        required: true
        type: number

env:
  # Configuration type to build.
  BUILD_CONFIGURATION: Release
  # Path to the project file relative to the root of the project.
  MAIN_PROJECT_FILE: .\src\Azure.Monitor.Telemetry.csproj
  # Pack output directory
  OUT_DIRECTORY: .\out
  # Verbosity level
  VERBOSITY: quiet
  # Version
  VERSION: "${{ github.event.inputs.versionMajor }}.${{ github.event.inputs.versionMinor }}.0"

jobs:
  Run:
    # one of target frameworks is net462
    runs-on: windows-latest

    steps:
    - name: Checkout Sources
      uses: actions/checkout@v4

    - name: Pack Project
      run: >-
        dotnet pack ${{ env.MAIN_PROJECT_FILE }}
        --configuration ${{ env.BUILD_CONFIGURATION }}
        --output ${{ env.OUT_DIRECTORY }}
        --verbosity ${{ env.VERBOSITY }}
        -p:PackageVersion=${{ env.VERSION }}
        -p:PackageProjectUrl=${{ github.repositoryUrl }}
        -p:RepositoryBranch=${{ github.ref_name }}
        -p:RepositoryCommit=${{ github.sha }}
        -p:RepositoryUrl=${{ github.repositoryUrl }}

    - name: Upload Package
      uses: actions/upload-artifact@v4
      with:
        name: package
        path: ${{ env.OUT_DIRECTORY }}
